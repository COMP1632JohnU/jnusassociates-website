<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Global Market Ticker | JNUS Associates Ltd</title>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest" defer></script>

  <style>
    /* ===== GLOBAL ===== */
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #e0f7f7;
      font-family: "Inter", sans-serif;
      height: 100%;
      overflow: hidden;
    }

    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-image: url('gracechurch.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    /* ===== REGION HEADERS ===== */
    .region-bar, .cities-bar {
      text-align: center;
      color: #00f5d4;
      text-shadow: 0 0 8px rgba(0,255,255,0.6);
      font-weight: 600;
      font-size: clamp(0.9rem, 1.6vw, 1.2rem);
    }

    .cities-bar {
      color: #aef;
      font-weight: 400;
      margin-top: 6px;
      margin-bottom: 14px;
      font-size: clamp(0.8rem, 1.4vw, 1rem);
    }

    /* ===== TICKER BAR ===== */
    .ticker-bar {
      width: 90%;
      max-width: 1100px;
      background: rgba(0, 0, 0, 0.45);
      border: 1px solid rgba(0,255,255,0.25);
      border-radius: 14px;
      box-shadow: 0 0 20px rgba(0,255,255,0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      overflow: hidden;
      opacity: 0;
      animation: fadeIn 1.5s ease-in-out 2s forwards;
      padding: 10px 0;
    }

    .ticker-content {
      display: inline-block;
      white-space: nowrap;
      animation: scrollTicker 60s linear infinite;
    }

    .teal-glow { color: #00f5d4; text-shadow: 0 0 8px rgba(0,255,255,0.6); font-weight: bold; }
    .red-glow { color: #ff5c5c; text-shadow: 0 0 8px rgba(255,80,80,0.6); font-weight: bold; }
    .neutral-glow { color: #ddd; }

    @keyframes scrollTicker {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* ===== FOOTER ===== */
    footer {
      text-align: center;
      color: #aef;
      background: rgba(0,0,0,0.6);
      border: 1px solid rgba(0,255,255,0.25);
      border-radius: 10px;
      box-shadow: 0 0 14px rgba(0,255,255,0.15);
      backdrop-filter: blur(10px);
      padding: 10px 15px;
      font-size: clamp(0.75rem, 1.5vw, 0.9rem);
      position: absolute;
      bottom: 15px;
      width: 80%;
      max-width: 600px;
    }
    footer a { color: #00f5d4; text-decoration: none; }

    @media (max-width: 768px) {
      .ticker-bar { width: 95%; }
      .region-bar, .cities-bar { font-size: 0.85rem; }
    }
  </style>
</head>

<body>
  <div class="region-bar">üåç AFRICA ‚Ä¢ EUROPE ‚Ä¢ AMERICA ‚Ä¢ ASIA-PACIFIC</div>
  <div class="cities-bar">Lagos ‚Ä¢ Johannesburg ‚Ä¢ London ‚Ä¢ New York ‚Ä¢ Shanghai ‚Ä¢ Tokyo</div>

  <div class="ticker-bar">
    <div id="tickerContent" class="ticker-content">
      <span class="teal-glow">üìä Now showing: Initializing market data‚Ä¶</span>
    </div>
  </div>

  <footer>
    ¬© 2025 JNUS Associates Ltd | <a href="/">Back to Home</a>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (window.lucide) lucide.createIcons();

      const FINNHUB_KEY = "d3tjfj9r01qigeg3f3v0d3tjfj9r01qigeg3f3vg";
      const ALPHA_KEY = "HARHFLFJZZBX044Y";
      const tickerContent = document.getElementById("tickerContent");

      async function fetchStocks() {
        try {
          // Finnhub base
          const res = await fetch(`https://finnhub.io/api/v1/stock/symbol?exchange=US&token=${FINNHUB_KEY}`);
          const data = await res.json();
          const symbols = Array.from(new Set(data.map(i => i.symbol))).slice(0, 40); // More variety
          
          const results = await Promise.allSettled(
            symbols.map(async s => {
              const r = await fetch(`https://finnhub.io/api/v1/quote?symbol=${encodeURIComponent(s)}&token=${FINNHUB_KEY}`);
              const d = await r.json();
              const price = parseFloat(d.c);
              const pct = parseFloat(d.dp);
              const cls = pct > 0 ? "teal-glow" : pct < 0 ? "red-glow" : "neutral-glow";
              const arrow = pct > 0 ? "‚ñ≤" : pct < 0 ? "‚ñº" : "‚Ä¢";
              return `<span class="${cls}">${s}: ${isFinite(price)?price.toFixed(2):"N/A"} (${isFinite(pct)?pct.toFixed(2):"0"}%) ${arrow}</span>`;
            })
          );

          const html = results.filter(r => r.status === "fulfilled").map(r => r.value).join(" ‚Ä¢ ");
          tickerContent.innerHTML = `<span class="teal-glow">üìä Now showing: New York Stock Exchange</span> ‚Ä¢ ${html}`;
        } catch (e) {
          console.error("Primary API failed, attempting Alpha Vantage backup...", e);
          try {
            const alphaRes = await fetch(`https://www.alphavantage.co/query?function=TOP_GAINERS_LOSERS&apikey=${ALPHA_KEY}`);
            const alphaData = await alphaRes.json();
            if (alphaData?.top_gainers) {
              const html = alphaData.top_gainers
                .slice(0, 30)
                .map(g => `<span class="teal-glow">${g.ticker}: ${g.price} (${g.change_percentage}) ‚ñ≤</span>`)
                .join(" ‚Ä¢ ");
              tickerContent.innerHTML = `<span class="teal-glow">üìä Now showing: Global Equities</span> ‚Ä¢ ${html}`;
            } else {
              tickerContent.innerHTML = `<span class="neutral-glow">Unable to fetch data from both APIs</span>`;
            }
          } catch {
            tickerContent.innerHTML = `<span class="neutral-glow">Unable to fetch live data</span>`;
          }
        }
      }

      setTimeout(fetchStocks, 2000);
      setInterval(fetchStocks, 1800000);
    });
  </script>
</body>
</html>